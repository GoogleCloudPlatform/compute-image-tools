{
  "Name": "windows-configuration-test",
  "Vars": {
    "source_image": {"Required": true, "Description": "Image to be tested"}
  },
  "Sources": {
    "configuration_test.ps1": "./windows/configuration_test.ps1"
  },
  "Steps": {
    "create-disk": {
      "CreateDisks": [
        {
          "Name": "disk",
          "SourceImage": "${source_image}",
          "Type": "pd-ssd"
        }
      ]
    },
    "create-configuration-instance": {
      "CreateInstances": [
        {
          "Name": "inst-configuration",
          "Disks": [{"Source": "disk"}],
          "StartupScript": "configuration_test.ps1",
          "Metadata": {
            "zone": "${ZONE}",
            "project": "${PROJECT}"
          },
          "Scopes": ["https://www.googleapis.com/auth/cloud-platform"]
        }
      ]
    },
    "wait-for-test-completion": {
      "Timeout": "5m",
      "WaitForInstancesSignal": [
        {
          "Name": "inst-configuration",
          "SerialOutput": {
            "Port": 1,
            "SuccessMatch": "TestSuccess",
            "FailureMatch": "TestFailed"
          }
        }
      ]
    }
  },
  "Dependencies": {
    "create-configuration-instance": ["create-disk"],
    "wait-for-test-completion": ["create-configuration-instance"]
  }
}
