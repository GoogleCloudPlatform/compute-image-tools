{
  "Name": "sql-2017-express-windows-2016-dc-image-build",
  "Vars": {
    "build_date": "${TIMESTAMP}",
    "install_disk": "disk-install",
    "publish_project": "${PROJECT}",
    "sql_server_media": {"Required": true, "Description": "GCS or local path to Windows installer media"},
    "source_image_project": {"Value": "windows-cloud", "Description": "Project to source base image from."},
    "ssms_exe": {"Required": true, "Description": "GCS or local path to SSMS installer"}
  },
  "Steps": {
    "build-sql-image": {
      "TimeOut": "70m",
      "IncludeWorkflow": {
        "Path": "./sqlserver.wf.json",
        "Vars": {
          "sql_server_config": "./configs/sql_server_2017.ini",
          "sql_server_media": "${sql_server_media}",
          "source_image": "projects/${source_image_project}/global/images/family/windows-2016",
          "install_disk": "${install_disk}",
          "ssms_exe": "${ssms_exe}"
        }
      }
    },
    "create-image": {
      "CreateImages": [
        {
          "Name": "sql-2016-enterprise-windows-2016-dc-v${build_date}",
          "SourceDisk": "${install_disk}",
          "Licenses": [
            "projects/windows-sql-cloud/global/licenses/sql-server-2017-express"
          ],
          "Description": "Microsoft, SQL Server 2017 Express, on Windows Server 2016, x64 built on ${build_date}",
          "GuestOsFeatures": [{"Type":"VIRTIO_SCSI_MULTIQUEUE"}, {"Type":"WINDOWS"}, {"Type":"MULTI_IP_SUBNET"}],
          "Family": "sql-exp-2017-win-2016",
          "Project": "${publish_project}",
          "NoCleanup": true,
          "ExactName": true
        }
      ]
    }
  },
  "Dependencies": {
    "create-image": ["build-sql-image"]
  }
}
