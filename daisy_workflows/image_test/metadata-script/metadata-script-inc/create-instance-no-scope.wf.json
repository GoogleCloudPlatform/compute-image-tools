{
  "Name": "create-instance-no-scope",
  "Vars": {
    "instance": {"Required": true, "Description": "The name of the instance to be created"},
    "source_image": {"Required": true, "Description": "Image to be tested"},

    "startup_script_meta_key": {"Value": "Foo", "Description": "The metadata key name for the {startup_script_meta} parameter"},
    "windows_startup_script_meta_key": {"Value": "Fu", "Description": "The windows metadata key name for the {startup_script_meta} parameter"},
    "startup_script_meta": {"Value": "Foo", "Description": "The metadata startup script of the created instance"},

    "shutdown_script_meta_key": {"Value": "Bar", "Description": "The metadata key name for the {shutdown_script} parameter"},
    "windows_shutdown_script_meta_key": {"Value": "Baz", "Description": "The windows metadata key name for the {shutdown_script} parameter"},
    "shutdown_script_meta": {"Value": "Bar", "Description": "The metadata shutdown script of the created instance"}
  },
  "Steps": {
    "create-instance": {
      "CreateInstances": [
        {
          "Name": "${instance}",
          "Disks": [{"InitializeParams": {"SourceImage": "${source_image}"}, "AutoDelete": true}],
          "Scopes": [],
          "Metadata": {
            "${startup_script_meta_key}": "${startup_script_meta}",
            "${windows_startup_script_meta_key}": "${startup_script_meta}",

            "${shutdown_script_meta_key}": "${shutdown_script_meta}",
            "${windows_shutdown_script_meta_key}": "${shutdown_script_meta}"
          }
        }
      ]
    },
    "wait-for-boot": {
      "WaitForInstancesSignal": [
        {
          "Name": "${instance}",
          "SerialOutput": {
            "Port": 1,
            "SuccessMatch": "Finished running startup scripts"
          }
        }
      ]
    }
  },
  "Dependencies": {
    "wait-for-boot": ["create-instance"]
  }
}
